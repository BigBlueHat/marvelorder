---
import { byListingDate } from '../helpers/sort.ts'
import { getListingFromFile } from '../helpers/node/listing.ts'

import Layout from '../layouts/HorizontalScroll.astro'

const pages = await Astro.glob('../pages/en/*.md')


let listings = await Promise.all( pages.map( async page => {
  const { listing } = await getListingFromFile( page.file )

  listing.date = new Date( listing.date )
  listing.year = listing.date.getFullYear()

  return listing
}) )

// Sort lstings by date
listings = listings.sort( byListingDate ).reverse()

// console.log( 'listing', listings[0] )

---
<Layout>

	<div class="video-row relative fill-height w-screen">

		<div 
			class="video-row-contents flex overflow-x-auto whitespace-no-wrap space-x-6" 
			style="scroll-snap-type:x mandatory;"
		>

			{ listings.map( listing => (
				<article class="video-card w-full flex-shrink-0 flex-grow-0 border-2 border-transparent rounded-2xl overflow-hidden" style="max-width: 325px; flex-basis: 325px; scroll-snap-align: end;">
					<a href={ `/en/${ listing.slug }` } class="">
						<div class="video-card-container relative overflow-hidden bg-black">
							<div class="video-card-image h-screen">
								<div class="relative overflow-hidden w-full">
														
									<picture>

										
											<source sizes="(max-width: 640px) 100vw, 640px" data-srcset="https://i.ytimg.com/vi_webp/UjUsTiVLBC8/default.webp 120w, https://i.ytimg.com/vi_webp/UjUsTiVLBC8/mqdefault.webp 320w, https://i.ytimg.com/vi_webp/UjUsTiVLBC8/hqdefault.webp 480w, https://i.ytimg.com/vi_webp/UjUsTiVLBC8/sddefault.webp 640w" type="image/webp" srcset="https://i.ytimg.com/vi_webp/UjUsTiVLBC8/default.webp 120w, https://i.ytimg.com/vi_webp/UjUsTiVLBC8/mqdefault.webp 320w, https://i.ytimg.com/vi_webp/UjUsTiVLBC8/hqdefault.webp 480w, https://i.ytimg.com/vi_webp/UjUsTiVLBC8/sddefault.webp 640w">
										
											<source sizes="(max-width: 640px) 100vw, 640px" data-srcset="https://i.ytimg.com/vi/UjUsTiVLBC8/default.jpg 120w, https://i.ytimg.com/vi/UjUsTiVLBC8/mqdefault.jpg 320w, https://i.ytimg.com/vi/UjUsTiVLBC8/hqdefault.jpg 480w, https://i.ytimg.com/vi/UjUsTiVLBC8/sddefault.jpg 640w" type="image/jpeg" srcset="https://i.ytimg.com/vi/UjUsTiVLBC8/default.jpg 120w, https://i.ytimg.com/vi/UjUsTiVLBC8/mqdefault.jpg 320w, https://i.ytimg.com/vi/UjUsTiVLBC8/hqdefault.jpg 480w, https://i.ytimg.com/vi/UjUsTiVLBC8/sddefault.jpg 640w">
										

										<img data-src="https://i.ytimg.com/vi/UjUsTiVLBC8/default.jpg" alt="AirTag Delivery Day, iMac Pricing Details, Magic Keyboards" class="absolute inset-0 h-full w-full object-cover ls-is-cached lazyloaded" src="https://i.ytimg.com/vi/UjUsTiVLBC8/default.jpg">
									</picture>
					
								</div>
							</div>
							<div style="--gradient-from-color: rgba(0, 0, 0, 1); --gradient-to-color: rgba(0, 0, 0, 0.7)" class="video-card-overlay absolute inset-0 flex justify-between items-start bg-gradient-to-tr from-black to-transparent p-4">
								<div class="play-circle w-8 h-8 bg-white-2 flex justify-center items-center outline-0 rounded-full ease">
									<svg viewBox="0 0 18 18" style="width:18px;height:18px;margin-left:3px">
										<path fill="currentColor" d="M15.562 8.1L3.87.225c-.818-.562-1.87 0-1.87.9v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"></path>
									</svg>
								</div>
							</div>

							<!-- Video Text Content -->
							<div class="video-card-content absolute inset-0 flex items-end py-4 px-6">
								<h2 class="w-full text-3xl test-white font-bold text-left whitespace-normal">{ listing.title }</h2>
								<div>{ listing.year }</div>
							</div>
						</div>
					</a>
				</article>
			)) }

		</div>

		<!-- <button class="absolute left-0 h-10 w-10 flex justify-center items-center transform -translate-y-1/2 -translate-x-1/2 bg-darker rounded-full" style="top:50%;" distance="-325" scroll-target="#row-adn9shse7" onclick="scrollHorizontalCarousel( event )" aria-label="Scroll to previous videos">
			<svg viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5 text-gray-400" style="transform: scaleX(-1);">
				<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
			</svg>
		</button>
		<button class="absolute right-0 h-10 w-10 flex justify-center items-center transform -translate-y-1/2 translate-x-1/2 bg-darker rounded-full" style="top:50%;" distance="325" scroll-target="#row-adn9shse7" onclick="scrollHorizontalCarousel( event )" aria-label="Scroll to next videos">
			<svg viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5 text-gray-400">
				<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
			</svg>
		</button> -->

	</div>

	
  
	<script is:inline>
		// Redirect your homepage to the first page of documentation.
		// If you have a landing page, remove this script and add it here!
		// window.location.pathname = `/en/introduction`;
	</script>
</Layout>